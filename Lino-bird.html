<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è¨ºã‚µãƒ</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    header {
      background: #2e6da4;
      color: white;
      padding: 10px;
      text-align: center;
    }
    main {
      display: flex;
      flex: 1;
    }
    section {
      padding: 10px;
      overflow-y: auto;
    }
    #transcription {
      width: 40%;
      border-right: 2px solid #ccc;
    }
    #info-fields {
      width: 60%;
    }
    textarea, input {
      width: 100%;
      margin: 5px 0;
      padding: 5px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 10px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    ul li:hover {
      background: #eef;
    }
  </style>
</head>
<body>
  <header>
    <h1>è¨ºã‚µãƒ</h1>
    <br><h2>åŒ»ç™‚è·ã«ä½™è£•ã‚ã‚‹æ‚£è€…ã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›</h2>
  </header>
  <main>
    <!-- A: éŸ³å£°æ–‡å­—èµ·ã“ã—ç”»é¢ -->
    <section id="transcription">
      <h2>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—èµ·ã“ã—</h2>
      <div id="output" style="min-height: 200px; border: 1px solid #ccc; padding: 10px;"></div>
      <div id="status" style="margin-top: 10px; color: green; font-weight: bold;">â— éŒ²éŸ³åœæ­¢ä¸­</div>
      <button onclick="startRecording()">ğŸ¤ éŒ²éŸ³é–‹å§‹</button>
      <button onclick="stopRecording()">â¹ éŒ²éŸ³åœæ­¢</button>

      <h3>ğŸ•’ ç™ºè¨€ãƒ­ã‚°</h3>
      <ul id="log" style="max-height: 200px; overflow-y: auto; padding: 5px; border: 1px solid #ccc;"></ul>
    </section>

    <!-- B: æƒ…å ±å…¥åŠ›æ¬„ -->
    <section id="info-fields">
      <h2>ã‚«ãƒ«ãƒ†</h2>
      <input id="doc-title" placeholder="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›">
      <button onclick="fillDummyInfo()">ğŸªª ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’èª­ã¿å–ã‚‹ï¼ˆä»®ï¼‰</button>
      <textarea id="basic-info" placeholder="åŸºæœ¬æƒ…å ±ï¼ˆè¨ºå¯Ÿåˆ¸ç­‰ï¼‰"></textarea>
      <textarea id="symptoms" placeholder="ç—‡çŠ¶"></textarea>
      <textarea id="exams" placeholder="æ¤œæŸ»çµæœ"></textarea>
      <textarea id="treatment" placeholder="æ²»ç™‚æ–¹é‡"></textarea>
      <textarea id="progress" placeholder="çµŒéè¨˜éŒ²"></textarea>
      <textarea id="medication" placeholder="è–¬"></textarea>
      <button onclick="saveDocument()">ğŸ’¾ ä¿å­˜</button>

      <h3>ğŸ“‚ ä¿å­˜æ¸ˆã¿ã‚«ãƒ«ãƒ†</h3>
      <ul id="doc-list"></ul>
    </section>
  </main>

  <script>
    let recognition;

    function startRecording() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Google Chromeã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚");
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = 'ja-JP';
      recognition.continuous = true;

      recognition.onresult = (event) => {
        let transcript = '';
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          transcript += event.results[i][0].transcript;
        }

        document.getElementById('output').innerText += transcript + '\n';
        classifyAndInsert(transcript);
        logTranscript(transcript);
      };

      recognition.start();
      document.getElementById('status').textContent = "â— éŒ²éŸ³ä¸­";
      document.getElementById('status').style.color = "red";
    }

    function stopRecording() {
      if (recognition) {
        recognition.stop();
        document.getElementById('status').textContent = "â— éŒ²éŸ³åœæ­¢ä¸­";
        document.getElementById('status').style.color = "green";
      }
    }

    function classifyAndInsert(text) {
      const categories = {
        symptoms: ['é ­ç—›', 'ç†±', 'å’³', 'ç—›ã¿', 'åãæ°—', 'ã‚ã¾ã„', 'ã ã‚‹ã•'],
        exams: ['è¡€æ¶²æ¤œæŸ»', 'CT', 'MRI', 'çµæœ', 'ç•°å¸¸', 'æ•°å€¤', 'æ‰€è¦‹'],
        treatment: ['ç‚¹æ»´', 'æ‰‹è¡“', 'è–¬', 'ç™‚æ³•', 'æ²»ç™‚', 'å‡¦æ–¹'],
        progress: ['æ”¹å–„', 'æ‚ªåŒ–', 'çµŒé', 'çŠ¶æ…‹', 'æ§˜å­', 'å…¥é™¢å¾Œ'],
        medication: ['è–¬', 'æœç”¨', 'éŒ å‰¤', 'é£²ã¿è–¬', 'å‡¦æ–¹', 'æŠ—ç”Ÿç‰©è³ª']
      };

      for (const [field, keywords] of Object.entries(categories)) {
        for (const keyword of keywords) {
          if (text.includes(keyword)) {
            const fieldEl = document.getElementById(field);
            fieldEl.value += text.trim() + '\n';
            return;
          }
        }
      }
    }

    function fillDummyInfo() {
      const dummyInfo = `
æ°åï¼šå±±ç”° å¤ªéƒ
æ€§åˆ¥ï¼šç”·æ€§
ç”Ÿå¹´æœˆæ—¥ï¼š1980å¹´5æœˆ12æ—¥
ä¿é™ºç•ªå·ï¼š1234-5678-9012
è¨ºå¯Ÿåˆ¸ç•ªå·ï¼šA-20250411
      `.trim();

      document.getElementById('basic-info').value = dummyInfo;
    }

    function saveDocument() {
      const doc = {
        title: document.getElementById('doc-title').value,
        basicInfo: document.getElementById('basic-info').value,
        symptoms: document.getElementById('symptoms').value,
        exams: document.getElementById('exams').value,
        treatment: document.getElementById('treatment').value,
        progress: document.getElementById('progress').value,
        medication: document.getElementById('medication').value,
        timestamp: new Date().toISOString()
      };
      localStorage.setItem(`doc-${doc.title}`, JSON.stringify(doc));
      alert("ã‚«ãƒ«ãƒ†ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
      loadSavedDocs();
    }

    function loadSavedDocs() {
      const list = document.getElementById('doc-list');
      list.innerHTML = '';

      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith("doc-")) {
          const li = document.createElement('li');
          li.textContent = key.replace("doc-", "");
          li.style.cursor = 'pointer';
          li.onclick = () => {
            const doc = JSON.parse(localStorage.getItem(key));
            document.getElementById('doc-title').value = doc.title;
            document.getElementById('basic-info').value = doc.basicInfo;
            document.getElementById('symptoms').value = doc.symptoms;
            document.getElementById('exams').value = doc.exams;
            document.getElementById('treatment').value = doc.treatment;
            document.getElementById('progress').value = doc.progress;
            document.getElementById('medication').value = doc.medication;
            alert(`ã€Œ${doc.title}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
          };
          list.appendChild(li);
        }
      }
    }

    function logTranscript(text) {
      const logList = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const li = document.createElement('li');
      li.textContent = `[${timestamp}] ${text}`;
      logList.appendChild(li);
    }

    window.onload = loadSavedDocs;
  </script>
</body>
</html>

