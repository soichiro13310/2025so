<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>åŒ»ç™‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã‚¢ãƒ—ãƒª</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    header {
      background: #2e6da4;
      color: white;
      padding: 10px;
      text-align: center;
    }
    main {
      display: flex;
      flex: 1;
    }
    section {
      padding: 10px;
      overflow-y: auto;
    }
    #transcription {
      width: 40%;
      border-right: 2px solid #ccc;
    }
    #info-fields {
      width: 60%;
    }
    textarea, input {
      width: 100%;
      margin: 5px 0;
      padding: 5px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>åŒ»ç™‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã‚¢ãƒ—ãƒª</h1>
  </header>
  <main>
    <!-- A: éŸ³å£°æ–‡å­—èµ·ã“ã—ç”»é¢ -->
    <section id="transcription">
      <h2>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—èµ·ã“ã—</h2>
      <div id="output" style="min-height: 200px; border: 1px solid #ccc; padding: 10px;"></div>
      <button onclick="startRecording()">ğŸ¤ éŒ²éŸ³é–‹å§‹</button>
      <button onclick="stopRecording()">â¹ éŒ²éŸ³åœæ­¢</button>
    </section>

    <!-- B: æƒ…å ±å…¥åŠ›æ¬„ -->
    <section id="info-fields">
      <h2>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæƒ…å ±</h2>
      <input id="doc-title" placeholder="ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›">
      <textarea id="basic-info" placeholder="åŸºæœ¬æƒ…å ±ï¼ˆè¨ºå¯Ÿåˆ¸ç­‰ï¼‰"></textarea>
      <textarea id="symptoms" placeholder="ç—‡çŠ¶"></textarea>
      <textarea id="exams" placeholder="æ¤œæŸ»çµæœ"></textarea>
      <textarea id="treatment" placeholder="æ²»ç™‚æ–¹é‡"></textarea>
      <textarea id="progress" placeholder="çµŒéè¨˜éŒ²"></textarea>
      <textarea id="medication" placeholder="è–¬"></textarea>
      <button onclick="saveDocument()">ğŸ’¾ ä¿å­˜</button>
    </section>
  </main>

  <script>
    // éŸ³å£°èªè­˜å‡¦ç†ï¼ˆç°¡æ˜“ï¼šWeb Speech APIä½¿ç”¨ï¼‰
    let recognition;
    function startRecording() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
        return;
      }
      recognition = new SpeechRecognition();
      recognition.lang = 'ja-JP';
      recognition.continuous = true;

      recognition.onresult = (event) => {
        let transcript = '';
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          transcript += event.results[i][0].transcript;
        }
        document.getElementById('output').innerText += transcript + '\n';
        // TODO: NLPã§å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†é¡ï¼ˆæ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã§ï¼‰
      };

      recognition.start();
    }

    function stopRecording() {
      if (recognition) {
        recognition.stop();
      }
    }

    function saveDocument() {
      const doc = {
        title: document.getElementById('doc-title').value,
        basicInfo: document.getElementById('basic-info').value,
        symptoms: document.getElementById('symptoms').value,
        exams: document.getElementById('exams').value,
        treatment: document.getElementById('treatment').value,
        progress: document.getElementById('progress').value,
        medication: document.getElementById('medication').value,
        timestamp: new Date().toISOString()
      };
      localStorage.setItem(`doc-${doc.title}`, JSON.stringify(doc));
      alert("ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
    }
  </script>
</body>
</html>
